#!env bash

FILENAME="do/publish"
ENV_FILE=".project.env"

if [ "$0" != "$FILENAME" ]; then
	echo "error: must be called as ${FILENAME} from project directory"
	echo "exiting"
	exit
fi

if [ ! -f "$ENV_FILE" ]; then
	echo "error: missing ${ENV_FILE}"
	echo "exiting"
	exit
fi

date 
source $ENV_FILE

echo "publishing with rsyn over ssh..."
echo -n "SSH_USER_SERVER_PATH: "
echo $SSH_USER_SERVER_PATH

if [ "" == "$SSH_USER_SERVER_PATH" ]; then
	echo "error: missing value for SSH_USER_SERVER_PATH"
	echo "exiting"
	exit
fi

# rsync -avz --delete -e ssh ./public --exclude="files" example-user@example-server:/var/www/vhosts/example-site/current/
rsync -avz --delete -e ssh ./public --exclude="files" $SSH_USER_SERVER_PATH

date
echo -n "finished "

